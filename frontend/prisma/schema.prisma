// Prisma Schema for Portfolio System
// Converted from SQL migrations

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Users table (admin users)
model User {
  id         String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String      @unique
  name       String?
  avatarUrl  String?     @map("avatar_url")
  role       String      @default("admin")
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)

  mediaFiles MediaFile[]

  @@index([email])
  @@map("users")
}

// Projects table
model Project {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title        String
  slug         String   @unique
  description  String?
  techStack    String[] @default([]) @map("tech_stack")
  githubUrl    String?  @map("github_url")
  demoUrl      String?  @map("demo_url")
  thumbnailUrl String?  @map("thumbnail_url")
  images       String[] @default([])
  published    Boolean  @default(false)
  displayOrder Int      @default(0) @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([published])
  @@index([displayOrder])
  @@map("projects")
}

// Publications table
model Publication {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title     String
  slug      String   @unique
  authors   String[]
  year      Int
  venue     String?
  doi       String?
  arxivId   String?  @map("arxiv_id")
  pdfUrl    String?  @map("pdf_url")
  abstract  String?
  tags      String[] @default([])
  published Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([year(sort: Desc)])
  @@index([published])
  @@map("publications")
}

// Blog posts table
model BlogPost {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String
  slug          String    @unique
  excerpt       String?
  contentUrl    String?   @map("content_url")
  coverImageUrl String?   @map("cover_image_url")
  tags          String[]  @default([])
  published     Boolean   @default(false)
  publishedAt   DateTime? @map("published_at") @db.Timestamptz(6)
  readingTime   Int       @default(0) @map("reading_time")
  views         Int       @default(0)
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([slug])
  @@index([publishedAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@map("blog_posts")
}

// Media files table
model MediaFile {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  originalName String   @map("original_name")
  storagePath  String   @map("storage_path")
  url          String
  mimeType     String   @map("mime_type")
  sizeBytes    BigInt   @map("size_bytes")
  uploadedBy   String?  @map("uploaded_by") @db.Uuid
  metadata     Json     @default("{}")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  user User? @relation(fields: [uploadedBy], references: [id], onDelete: SetNull)

  @@index([uploadedBy])
  @@index([mimeType])
  @@index([createdAt(sort: Desc)])
  @@map("media_files")
}
